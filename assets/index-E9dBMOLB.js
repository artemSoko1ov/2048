(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const i of t.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function s(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function o(e){if(e.ep)return;e.ep=!0;const t=s(e);fetch(e.href,t)}})();class d{selectors={root:"[data-js-game]",overlay:"[data-js-game-overlay]",buttonRestart:"[data-js-game-button-restart]"};stateClasses={isActive:"active"};rootElement;overlayElement;buttonRestartElement;board;constructor(){this.rootElement=document.querySelector(this.selectors.root),this.overlayElement=document.querySelector(this.selectors.overlay),this.buttonRestartElement=document.querySelector(this.selectors.buttonRestart),this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.addRandomCell(),this.addRandomCell(),this.bindEvents()}addRandomCell=()=>{let r=[];if(this.board.forEach((t,i)=>{t.forEach((n,l)=>{n===0&&r.push([i,l])})}),r.length===0)return;const s=Math.floor(Math.random()*r.length),[o,e]=r[s];this.board[o][e]=Math.random()<.9?2:4,this.render()};transpose(r){return r[0].map((s,o)=>r.map(e=>e[o]))}moveLeft=()=>{let r=!1;this.board=this.board.map(s=>{const o=[...s];let e=s.filter(t=>t!==0);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]=e[t]*2,e[t+1]=0);for(e=e.filter(t=>t!==0);e.length<4;)e.push(0);for(let t=0;t<4;t++)if(e[t]!==o[t]){r=!0;break}return e}),r&&setTimeout(()=>{this.addRandomCell()},150)};moveRight=()=>{this.board=this.board.map(r=>r.reverse()),this.moveLeft(),this.board=this.board.map(r=>r.reverse())};moveUp=()=>{this.board=this.transpose(this.board),this.moveLeft(),this.board=this.transpose(this.board)};moveDown=()=>{this.board=this.transpose(this.board),this.moveRight(),this.board=this.transpose(this.board)};isGameOver(){if(!this.board.some(s=>s.includes(0))){for(let s=0;s<4;s++)for(let o=0;o<3;o++)if(this.board[s][o]===this.board[s][o+1])return;for(let s=0;s<4;s++)for(let o=0;o<3;o++)if(this.board[o][s]===this.board[o+1][s])return;setTimeout(()=>this.showModal(),300)}}showModal(){this.overlayElement?.classList.add(this.stateClasses.isActive)}clearBoard=()=>{this.board=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.addRandomCell(),this.addRandomCell(),this.overlayElement?.classList.remove(this.stateClasses.isActive)};render(){this.rootElement&&(this.rootElement.innerHTML="",this.board.forEach(r=>{r.forEach(s=>{const o=document.createElement("div");o.classList.add("game-element"),s!==0&&(o.classList.add(`game--${s}`),o.textContent=s.toString()),this.rootElement?.appendChild(o)})}),this.isGameOver())}bindEvents(){document.addEventListener("keydown",r=>{switch(r.key){case"ArrowLeft":this.moveLeft();break;case"ArrowRight":this.moveRight();break;case"ArrowUp":this.moveUp();break;case"ArrowDown":this.moveDown();break}}),this.buttonRestartElement?.addEventListener("click",this.clearBoard)}}new d;
